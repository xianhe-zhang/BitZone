{"ast":null,"code":"import _slicedToArray from\"/Users/marioxzhang/Desktop/bitzone-finished/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useCallback,useEffect}from'react';var logoutTimer;export var useAuth=function useAuth(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),token=_useState2[0],setToken=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),tokenExpirationDate=_useState4[0],setTokenExpirationDate=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),userId=_useState6[0],setUserId=_useState6[1];var login=useCallback(function(uid,token,expirationDate){setToken(token);setUserId(uid);var tokenExpirationDate=expirationDate||new Date(new Date().getTime()+1000*60*60);setTokenExpirationDate(tokenExpirationDate);localStorage.setItem('userData',JSON.stringify({userId:uid,token:token,expiration:tokenExpirationDate.toISOString()}));},[]);var logout=useCallback(function(){setToken(null);setTokenExpirationDate(null);setUserId(null);localStorage.removeItem('userData');},[]);useEffect(function(){if(token&&tokenExpirationDate){var remainingTime=tokenExpirationDate.getTime()-new Date().getTime();logoutTimer=setTimeout(logout,remainingTime);}else{clearTimeout(logoutTimer);}},[token,logout,tokenExpirationDate]);useEffect(function(){var storedData=JSON.parse(localStorage.getItem('userData'));if(storedData&&storedData.token&&new Date(storedData.expiration)>new Date()){login(storedData.userId,storedData.token,new Date(storedData.expiration));}},[login]);return{token:token,login:login,logout:logout,userId:userId};};","map":{"version":3,"sources":["/Users/marioxzhang/Desktop/bitzone-finished/frontend/src/shared/hooks/auth-hook.js"],"names":["useState","useCallback","useEffect","logoutTimer","useAuth","token","setToken","tokenExpirationDate","setTokenExpirationDate","userId","setUserId","login","uid","expirationDate","Date","getTime","localStorage","setItem","JSON","stringify","expiration","toISOString","logout","removeItem","remainingTime","setTimeout","clearTimeout","storedData","parse","getItem"],"mappings":"2KAAA,OAASA,QAAT,CAAmBC,WAAnB,CAAgCC,SAAhC,KAAiD,OAAjD,CAEA,GAAIC,CAAAA,WAAJ,CAEA,MAAO,IAAMC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,EAAM,CAC3B,cAA0BJ,QAAQ,CAAC,KAAD,CAAlC,wCAAOK,KAAP,eAAcC,QAAd,eACA,eAAsDN,QAAQ,EAA9D,yCAAOO,mBAAP,eAA4BC,sBAA5B,eACA,eAA4BR,QAAQ,CAAC,KAAD,CAApC,yCAAOS,MAAP,eAAeC,SAAf,eAEA,GAAMC,CAAAA,KAAK,CAAGV,WAAW,CAAC,SAACW,GAAD,CAAMP,KAAN,CAAaQ,cAAb,CAAgC,CACxDP,QAAQ,CAACD,KAAD,CAAR,CACAK,SAAS,CAACE,GAAD,CAAT,CACA,GAAML,CAAAA,mBAAmB,CACvBM,cAAc,EAAI,GAAIC,CAAAA,IAAJ,CAAS,GAAIA,CAAAA,IAAJ,GAAWC,OAAX,GAAuB,KAAO,EAAP,CAAY,EAA5C,CADpB,CAEAP,sBAAsB,CAACD,mBAAD,CAAtB,CACAS,YAAY,CAACC,OAAb,CACE,UADF,CAEEC,IAAI,CAACC,SAAL,CAAe,CACbV,MAAM,CAAEG,GADK,CAEbP,KAAK,CAAEA,KAFM,CAGbe,UAAU,CAAEb,mBAAmB,CAACc,WAApB,EAHC,CAAf,CAFF,EAQD,CAdwB,CActB,EAdsB,CAAzB,CAgBA,GAAMC,CAAAA,MAAM,CAAGrB,WAAW,CAAC,UAAM,CAC/BK,QAAQ,CAAC,IAAD,CAAR,CACAE,sBAAsB,CAAC,IAAD,CAAtB,CACAE,SAAS,CAAC,IAAD,CAAT,CACAM,YAAY,CAACO,UAAb,CAAwB,UAAxB,EACD,CALyB,CAKvB,EALuB,CAA1B,CAOArB,SAAS,CAAC,UAAM,CACd,GAAIG,KAAK,EAAIE,mBAAb,CAAkC,CAChC,GAAMiB,CAAAA,aAAa,CAAGjB,mBAAmB,CAACQ,OAApB,GAAgC,GAAID,CAAAA,IAAJ,GAAWC,OAAX,EAAtD,CACAZ,WAAW,CAAGsB,UAAU,CAACH,MAAD,CAASE,aAAT,CAAxB,CACD,CAHD,IAGO,CACLE,YAAY,CAACvB,WAAD,CAAZ,CACD,CACF,CAPQ,CAON,CAACE,KAAD,CAAQiB,MAAR,CAAgBf,mBAAhB,CAPM,CAAT,CASAL,SAAS,CAAC,UAAM,CACd,GAAMyB,CAAAA,UAAU,CAAGT,IAAI,CAACU,KAAL,CAAWZ,YAAY,CAACa,OAAb,CAAqB,UAArB,CAAX,CAAnB,CACA,GACEF,UAAU,EACVA,UAAU,CAACtB,KADX,EAEA,GAAIS,CAAAA,IAAJ,CAASa,UAAU,CAACP,UAApB,EAAkC,GAAIN,CAAAA,IAAJ,EAHpC,CAIE,CACAH,KAAK,CAACgB,UAAU,CAAClB,MAAZ,CAAoBkB,UAAU,CAACtB,KAA/B,CAAsC,GAAIS,CAAAA,IAAJ,CAASa,UAAU,CAACP,UAApB,CAAtC,CAAL,CACD,CACF,CATQ,CASN,CAACT,KAAD,CATM,CAAT,CAWA,MAAO,CAAEN,KAAK,CAALA,KAAF,CAASM,KAAK,CAALA,KAAT,CAAgBW,MAAM,CAANA,MAAhB,CAAwBb,MAAM,CAANA,MAAxB,CAAP,CACD,CAjDM","sourcesContent":["import { useState, useCallback, useEffect } from 'react';\n\nlet logoutTimer;\n\nexport const useAuth = () => {\n  const [token, setToken] = useState(false);\n  const [tokenExpirationDate, setTokenExpirationDate] = useState();\n  const [userId, setUserId] = useState(false);\n\n  const login = useCallback((uid, token, expirationDate) => {\n    setToken(token);\n    setUserId(uid);\n    const tokenExpirationDate =\n      expirationDate || new Date(new Date().getTime() + 1000 * 60 * 60);\n    setTokenExpirationDate(tokenExpirationDate);\n    localStorage.setItem(\n      'userData',\n      JSON.stringify({\n        userId: uid,\n        token: token,\n        expiration: tokenExpirationDate.toISOString()\n      })\n    );\n  }, []);\n\n  const logout = useCallback(() => {\n    setToken(null);\n    setTokenExpirationDate(null);\n    setUserId(null);\n    localStorage.removeItem('userData');\n  }, []);\n\n  useEffect(() => {\n    if (token && tokenExpirationDate) {\n      const remainingTime = tokenExpirationDate.getTime() - new Date().getTime();\n      logoutTimer = setTimeout(logout, remainingTime);\n    } else {\n      clearTimeout(logoutTimer);\n    }\n  }, [token, logout, tokenExpirationDate]);\n\n  useEffect(() => {\n    const storedData = JSON.parse(localStorage.getItem('userData'));\n    if (\n      storedData &&\n      storedData.token &&\n      new Date(storedData.expiration) > new Date()\n    ) {\n      login(storedData.userId, storedData.token, new Date(storedData.expiration));\n    }\n  }, [login]);\n\n  return { token, login, logout, userId };\n};"]},"metadata":{},"sourceType":"module"}